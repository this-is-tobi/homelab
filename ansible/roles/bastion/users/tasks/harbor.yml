---
- name: Include cluster vars
  ansible.builtin.include_vars: inventory/group_vars/cluster.yml

- name: Set harbor project fact
  ansible.builtin.set_fact:
    harbor_project:
      project_name: "{{ item.username }}"
      metadata:
        public: "false"
        storage_limit: "{{ item.harbor_quota }}"
        auto_scan: "true"
      membership:
        role_id: 1
        member_group:
          id: 0
          group_name: "/{{ item.username }}"
          group_type: 0

- name: Create harbor project
  ansible.builtin.include_role:
    name: kube-services/harbor
    tasks_from: project.yml
  with_items:
    - "{{ harbor_project }}"

- name: Create harbor project
  ansible.builtin.include_role:
    name: kube-services/harbor
    tasks_from: quota.yml
  with_items:
    - "{{ harbor_project }}"

- name: Create harbor project membership
  ansible.builtin.include_role:
    name: kube-services/harbor
    tasks_from: membership.yml
  with_items:
    - "{{ harbor_project }}"

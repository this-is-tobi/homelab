---
- name: Include cluster vars
  ansible.builtin.include_vars: inventory/group_vars/cluster.yml

- name: Create default 'secret/' kv engine
  include_tasks: kv-engine.yml
  with_items: 
    - kv_path: "{{ item.username }}"

- name: Create policies
  include_tasks: policy.yml
  with_items: 
    - policy_name: "{{ item.username }}"
      policy: "{{ lookup('ansible.builtin.template', 'user-policy.json.j2') }}"

- name: Create admin group
  include_tasks: group.yml
  with_items: 
    - username: "{{ item.username }}"

# Init
- name: Init
  ansible.builtin.include_role:
    name: services/utils/initialize
  vars:
    include_keycloak: true

# Setup vault secrets
- name: Setup vault secrets
  ansible.builtin.include_tasks: vault-secrets.yml

# Get namespace
- name: Setup vars
  ansible.builtin.include_vars:
    file: "{{ playbook_dir }}/../argocd/apps/crowdsec/argocd/application.yaml"
    name: crowdsec_app_config

- name: Set fact for crowdsec secrets
  ansible.builtin.set_fact:
    crowdsec_namespace: "{{ crowdsec_app_config.spec.destination.namespace }}"

# Install
- name: Sync application
  include_tasks: roles/services/utils/synchronize/tasks/sync.yml
  vars:
    argocd_app: crowdsec

# Post install
- name: Post install
  include_tasks: post-install.yml

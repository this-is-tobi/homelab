# Deploy kubernetes kube-services
- hosts: localhost
  become: false
  environment:
    K8S_AUTH_KUBECONFIG: "{{ K8S_AUTH_KUBECONFIG }}"
  vars_files:
    - ../inventory/group_vars/all.yml
    - ../inventory/group_vars/kube-services/actions-runner-controller.yml
    - ../inventory/group_vars/kube-services/argocd.yml
    - ../inventory/group_vars/kube-services/cert-manager.yml
    - ../inventory/group_vars/kube-services/cloudnative-pg.yml
    - ../inventory/group_vars/kube-services/harbor.yml
    - ../inventory/group_vars/kube-services/keycloak.yml
    - ../inventory/group_vars/kube-services/mattermost.yml
    - ../inventory/group_vars/kube-services/minio.yml
    - ../inventory/group_vars/kube-services/sonarqube.yml
    - ../inventory/group_vars/kube-services/sonarqube.yml
    - ../inventory/group_vars/kube-services/traefik.yml
    - ../inventory/group_vars/kube-services/vault.yml
  roles:
    - name: ../roles/kube-services/longhorn
      tags:
        - longhorn 
        - storage

    - name: ../roles/kube-services/traefik
      tags:
        - traefik 
        - ingress-controller

    - name: ../roles/kube-services/cert-manager
      tags:
        - cert-manager
        - certmanager

    - name: ../roles/kube-services/prometheus
      tags:
        - prometheus
        - monitoring

    - name: ../roles/kube-services/grafana
      tags:
        - grafana
        - monitoring

    - name: ../roles/kube-services/cloudnative-pg
      tags:
        - postgres-operator
        - cnpg

    - name: ../roles/kube-services/keycloak
      tags:
        - keycloak
        - sso

    - name: ../roles/kube-services/argocd
      tags:
        - argocd
        - argo
        - gitops

    - name: ../roles/kube-services/minio
      tags:
        - minio
        - s3

    - name: ../roles/kube-services/harbor
      tags:
        - harbor
        - registry

    - name: ../roles/kube-services/sonarqube
      tags:
        - sonarqube
        - sonar

    - name: ../roles/kube-services/actions-runner-controller
      tags:
        - actions-runner-controller
        - arc
        - runners

    - name: ../roles/kube-services/vault
      tags:
        - vault

    - name: ../roles/kube-services/dashy
      tags:
        - dashy
        - dashboard

    - name: ../roles/kube-services/mattermost
      tags:
        - never # Not arm64 compatible
        - mattermost
        - mm

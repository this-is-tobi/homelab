mlflow:
  ingress:
    hosts:
    - host: <path:secret/data/platforms/production/apps/mlflow#domain>
      paths:
      - path: /
        pathType: ImplementationSpecific
    tls:
    - hosts:
      - <path:secret/data/platforms/production/apps/mlflow#domain>
      secretName: <path:secret/data/platforms/production/apps/mlflow#domain>
  backendStore:
    postgres:
      host: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.host}>
      database: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.database}>
      user: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.app.username}>
      password: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.app.password}>
  artifactRoot:
    s3:
      bucket: <path:secret/data/platforms/production/apps/mlflow#s3 | jsonPath {.bucketName}>
      path: <path:secret/data/platforms/production/apps/mlflow#s3 | jsonPath {.bucketPrefix}>
      awsAccessKeyId: <path:secret/data/platforms/production/apps/mlflow#s3 | jsonPath {.accessKey}>
      awsSecretAccessKey: <path:secret/data/platforms/production/apps/mlflow#s3 | jsonPath {.secretKey}>
  extraEnvVars:
    MLFLOW_S3_ENDPOINT_URL: <path:secret/data/platforms/production/apps/mlflow#s3 | jsonPath {.endpoint}>
    AWS_DEFAULT_REGION: <path:secret/data/platforms/production/apps/mlflow#s3 | jsonPath {.region}>

cnpg:
  mode: primary
  credentials:
    password: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.app.password}>
    postgresPassword: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.admin.password}>
  backup:
    enabled: false
    endpointURL: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.s3.endpoint}>
    destinationPath: s3://<path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.s3.bucketName}>/<path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.s3.bucketPrefix}>
    s3Credentials:
      accessKeyId:
        value: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.s3.accessKey}>
      secretAccessKey:
        value: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.s3.secretKey}>
      region:
        value: <path:secret/data/platforms/production/apps/mlflow#postgres | jsonPath {.s3.region}>

sso:
  config:
    clientID: "<path:secret/data/platforms/production/apps/mlflow#keycloak | jsonPath {.clientId}>"
    clientSecret: "<path:secret/data/platforms/production/apps/mlflow#keycloak | jsonPath {.clientSecret}>"
    cookieSecret: "<path:secret/data/platforms/production/apps/mlflow#keycloak | jsonPath {.cookieSecret}>"
    configFile: |-
      provider = "keycloak-oidc"
      provider_display_name = "Keycloak"
      email_domains = [ "*" ]
      upstreams = [ "http://mlflow.mlflow.svc.cluster.local:5000/" ]
      redirect_url = "https://<path:secret/data/platforms/production/apps/mlflow#domain>/oauth2/callback"
      oidc_issuer_url = "https://<path:secret/data/platforms/production/apps/keycloak#domain>/realms/<path:secret/data/platforms/production/apps/keycloak#extras | jsonPath {.realm}>"
  ingress:
    hosts:
    - <path:secret/data/platforms/production/apps/mlflow#domain>
    tls:
    - secretName: <path:secret/data/platforms/production/apps/mlflow#domain>
      hosts:
      - <path:secret/data/platforms/production/apps/mlflow#domain>

mattermost:
  image:
    repository: ghcr.io/this-is-tobi/mirror/mattermost
    tag: 11.0.4
    imagePullPolicy: Always
  persistence:
    data:
      enabled: true
    plugins:
      enabled: true
  ingress:
    hosts:
    - <path:secret/data/platforms/production/apps/mattermost#domain>
    tls:
    - hosts:
      - <path:secret/data/platforms/production/apps/mattermost#domain>
      secretName: <path:secret/data/platforms/production/apps/mattermost#domain>
  externalDB:
    externalConnectionString: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.connectionString}>
  config:
    MM_SERVICESETTINGS_SITEURL: "https://<path:secret/data/platforms/production/apps/mattermost#domain>"
    MM_FILESETTINGS_AMAZONS3ACCESSKEYID: "<path:secret/data/platforms/production/apps/mattermost#s3 | jsonPath {.accessKey}>"
    MM_FILESETTINGS_AMAZONS3SECRETACCESSKEY: "<path:secret/data/platforms/production/apps/mattermost#s3 | jsonPath {.secretKey}>"
    MM_FILESETTINGS_AMAZONS3BUCKET: "<path:secret/data/platforms/production/apps/mattermost#s3 | jsonPath {.bucketName}>"
    MM_FILESETTINGS_AMAZONS3PATHPREFIX: "<path:secret/data/platforms/production/apps/mattermost#s3 | jsonPath {.bucketPrefix}>"
    MM_FILESETTINGS_AMAZONS3REGION: "<path:secret/data/platforms/production/apps/mattermost#s3 | jsonPath {.region}>"
    MM_FILESETTINGS_AMAZONS3ENDPOINT: "<path:secret/data/platforms/production/apps/mattermost#s3 | jsonPath {.endpoint}>"

cnpg:
  mode: primary
  credentials:
    password: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.app.password}>
    postgresPassword: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.admin.password}>
  backup:
    enabled: true
    endpointURL: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.s3.endpoint}>
    destinationPath: s3://<path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.s3.bucketName}>/<path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.s3.bucketPrefix}>
    s3Credentials:
      accessKeyId:
        value: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.s3.accessKey}>
      secretAccessKey:
        value: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.s3.secretKey}>
      region:
        value: <path:secret/data/platforms/production/apps/mattermost#postgres | jsonPath {.s3.region}>

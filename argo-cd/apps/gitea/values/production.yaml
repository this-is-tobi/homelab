gitea:
  ingress:
    hosts:
    - host: <path:secret/data/platforms/production/apps/gitea#domain>
      paths:
      - path: /
        pathType: Prefix
    tls:
    - secretName: <path:secret/data/platforms/production/apps/gitea#domain>
      hosts:
      - <path:secret/data/platforms/production/apps/gitea#domain>
  gitea:
    admin:
      username: <path:secret/data/platforms/production/apps/gitea#admin | jsonPath {.username}>
      password: <path:secret/data/platforms/production/apps/gitea#admin | jsonPath {.password}>
      email: admin@<path:secret/data/platforms/production/apps/gitea#domain>
    oauth:
    - name: Keycloak
      provider: openidConnect
      key: <path:secret/data/platforms/production/apps/gitea#keycloak | jsonPath {.clientId}>
      secret: <path:secret/data/platforms/production/apps/gitea#keycloak | jsonPath {.clientSecret}>
      autoDiscoverUrl: https://<path:secret/data/platforms/production/apps/keycloak#domain>/realms/<path:secret/data/platforms/production/apps/keycloak#extras | jsonPath {.realm}>/.well-known/openid-configuration
      scopes: "openid profile email roles groups"
      adminGroup: "admin"
      groupClaimName: "groups"
      # groupTeamMap: ""
      # groupTeamMapRemoval: true
    config:
      database:
        HOST: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.host}>:<path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.port}>
        NAME: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.database}>
        USER: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.app.username}>
        PASSWD: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.app.password}>
      server:
        DOMAIN: <path:secret/data/platforms/production/apps/gitea#domain>
        ROOT_URL: https://<path:secret/data/platforms/production/apps/gitea#domain>
      openid:
        WHITELISTED_URIS: <path:secret/data/platforms/production/apps/keycloak#domain>

cnpg:
  mode: primary
  credentials:
    password: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.app.password}>
    postgresPassword: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.admin.password}>
  backup:
    enabled: true
    endpointURL: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.s3.endpoint}>
    destinationPath: s3://<path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.s3.bucketName}>/<path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.s3.bucketPrefix}>
    s3Credentials:
      accessKeyId:
        value: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.s3.accessKey}>
      secretAccessKey:
        value: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.s3.secretKey}>
      region:
        value: <path:secret/data/platforms/production/apps/gitea#postgres | jsonPath {.s3.region}>

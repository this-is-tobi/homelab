sonarqube:
  ingress:
    hosts:
    - name: <path:secret/data/platforms/production/apps/sonarqube#domain>
      path: /
    tls:
    - hosts:
      - <path:secret/data/platforms/production/apps/sonarqube#domain>
      secretName: <path:secret/data/platforms/production/apps/sonarqube#domain>
  jdbcOverwrite:
    jdbcUrl: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.connectionString}>
    jdbcUsername: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.app.username}>
  sonarProperties:
    sonar.core.serverBaseURL: "https://<path:secret/data/platforms/production/apps/sonarqube#domain>"
    sonar.auth.oidc.issuerUri: "https://<path:secret/data/platforms/production/apps/keycloak#domain>/realms/<path:secret/data/platforms/production/apps/keycloak#extras | jsonPath {.realm}>"
    sonar.auth.oidc.clientId.secured: "<path:secret/data/platforms/production/apps/sonarqube#keycloak | jsonPath {.clientId}>"
    sonar.auth.oidc.clientSecret.secured: "<path:secret/data/platforms/production/apps/sonarqube#keycloak | jsonPath {.clientSecret}>"

cnpg:
  mode: primary
  credentials:
    password: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.app.password}>
    postgresPassword: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.admin.password}>
  backup:
    enabled: false
    endpointURL: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.s3.endpoint}>
    destinationPath: s3://<path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.s3.bucketName}>/<path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.s3.bucketPrefix}>
    s3Credentials:
      secretName: sonarqube-pg-cluster-backup
      accessKeyId:
        value: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.s3.accessKey}>
      secretAccessKey:
        value: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.s3.secretKey}>
      region:
        value: <path:secret/data/platforms/production/apps/sonarqube#postgres | jsonPath {.s3.region}>

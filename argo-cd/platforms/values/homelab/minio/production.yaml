minio:
  console:
    ingress:
      hostname: "minio.ohmlab.fr"
  ingress:
    hostname: "s3.ohmlab.fr"
    extraHosts:
    - name: "*.s3.ohmlab.fr"
      path: "/"
  persistence:
    size: "500Gi"

# VSO configuration using vso-utils helper chart
vso:
  # VaultAuth resource for Kubernetes authentication
  vaultAuth:
    default:
      method: "kubernetes"
      mount: "kubernetes"
      kubernetes:
        role: "minio"
        serviceAccount: "default"
  # VaultConnection resource for Vault server details
  vaultConnection:
    default:
      address: "https://vault.vault-operator-system.svc.cluster.local:8200"
      skipTLSVerify: true
  # VaultStaticSecret resources for each secret
  vaultStaticSecrets:
    # Minio admin credentials
    minioAdmin:
      mount: "homelab"
      path: "platforms/production/minio"
      type: "kv-v2"
      vaultAuthRef: "minio-vso-default"
      refreshAfter: "1h"
      hmacSecretData: true
      destination:
        name: "minio-admin"
        create: true
        type: "kubernetes.io/basic-auth"
        transformation:
          excludes:
          - ".*"
          templates:
            username:
              text: '{{ get .Secrets "admin" | dig "username" "" }}'
            password:
              text: '{{ get .Secrets "admin" | dig "password" "" }}'
    # Minio configuration
    minioConfig:
      mount: "homelab"
      path: "platforms/production/minio"
      type: "kv-v2"
      vaultAuthRef: "minio-vso-default"
      refreshAfter: "1h"
      hmacSecretData: true
      destination:
        name: "minio-config"
        create: true
        type: "Opaque"
        transformation:
          excludes:
          - ".*"
          templates:
            MINIO_IDENTITY_OPENID_CONFIG_URL:
              text: 'https://sso.ohmlab.fr/realms/homelab/.well-known/openid-configuration'
            MINIO_IDENTITY_OPENID_CLIENT_ID:
              text: '{{ get .Secrets "keycloak" | dig "clientId" "" }}'
            MINIO_IDENTITY_OPENID_CLIENT_SECRET:
              text: '{{ get .Secrets "keycloak" | dig "clientSecret" "" }}'
            MINIO_IDENTITY_OPENID_KEYCLOAK_ADMIN_URL:
              text: 'https://sso.ohmlab.fr/admin'
            MINIO_IDENTITY_OPENID_KEYCLOAK_REALM:
              text: 'homelab'
            MINIO_DOMAIN:
              text: 'https://s3.ohmlab.fr'
            MINIO_BROWSER_REDIRECT_URL:
              text: 'https://minio.ohmlab.fr/oauth_callback'

mlflow:
  ingress:
    hosts:
    - host: "mlflow.example.com"
      paths:
      - path: /
        pathType: ImplementationSpecific
    tls:
    - hosts:
      - "mlflow.example.com"
      secretName: "mlflow.example.com-tls"
  backendStore:
    postgres:
      host: "mlflow-pg-cluster-rw"
      database: "mlflow"
      user: "mlflow"
      password: ""
  artifactRoot:
    s3:
      bucket: "mlflow"
      path: ""
  extraEnvVars:
    MLFLOW_S3_ENDPOINT_URL: "https://s3.example.com"
    AWS_DEFAULT_REGION: "fr-par"
  extraSecretNamesForEnvFrom:
  - mlflow-s3 # AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY

cnpg:
  mode: "primary"
  credentials:
    existingSecrets:
      enabled: true
      postgres:
        secretName: "mlflow-pg-cluster-admin"
      app:
        secretName: "mlflow-pg-cluster-app"
  backup:
    enabled: true
    endpointURL: "https://s3.example.com"
    destinationPath: "s3://backups/cnpg"
    s3Credentials:
      create: false
      secretName: "mlflow-pg-cluster-backup"
      accessKeyId:
        key: "S3_ACCESS_KEY"
      secretAccessKey:
        key: "S3_SECRET_KEY"
      region:
        key: "S3_REGION"

sso:
  config:
    clientID: "mlflow"
    clientSecret: ""
    cookieSecret: ""
    configFile: |-
      provider = "keycloak-oidc"
      provider_display_name = "Keycloak"
      email_domains = [ "*" ]
      upstreams = [ "http://mlflow.mlflow.svc.cluster.local:5000/" ]
      redirect_url = "https://mlflow.example.com/oauth2/callback"
      oidc_issuer_url = "https://keycloak.example.com/realms/homelab"
  ingress:
    hosts:
    - "mlflow.example.com"
    tls:
    - secretName: "mlflow.example.com"
      hosts:
      - "mlflow.example.com"

vso:
  vaultStaticSecrets:
    mlflowAdmin:
      mount: "example"
      path: "platforms/production/mlflow"
    mlflowS3:
      mount: "example"
      path: "platforms/production/mlflow"
    mlflowDbInfos:
      mount: "example"
      path: "platforms/production/mlflow"
    mlflowDbAdmin:
      mount: "example"
      path: "platforms/production/mlflow"
    mlflowDbApp:
      mount: "example"
      path: "platforms/production/mlflow"
    mlflowPgBackup:
      mount: "example"
      path: "platforms/production/mlflow"
    mlflowSso:
      mount: "example"
      path: "platforms/production/mlflow"
